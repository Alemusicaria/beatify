<!DOCTYPE html>
<html lang="ca">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beatify | Inici sessió</title>
  <link rel="icon" href="../img/Logo_sense_fons.png">
  <link rel="stylesheet" href="../assets/css/login.css">
</head>

<body>

  <body>
    <div class="row">
      <div class="col-md-6 mx-auto p-0">
        <div class="card">
          <div class="login-box">
            <div class="login-snip">
              <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1"
                class="tab">Login</label>
              <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">Sign Up</label>
              <div class="login-space">
                <div class="login">
                  <br><br>
                  <div class="group">
                    <label for="username" class="label">Usuari</label>
                    <input id="username" type="text" class="input" placeholder="Posa el teu Usuari"
                      autocomplete="username">
                  </div>
                  <div class="group">
                    <label for="password" class="label">Contrasenya</label>
                    <input id="password" type="password" class="input" data-type="password"
                      placeholder="Posa la teva Contrasenya" autocomplete="current-password">
                  </div>
                  <div class="group">
                    <input type="submit" class="button" value="Log in" onclick="login()">
                  </div>
                  <div class="group">
                    <input id="check" type="checkbox" class="check">
                    <label for="check"><span class="icon"></span> Recorda</label>
                  </div>
                  <div class="hr"></div>
                  <div class="foot">
                    <a href="./recuperar.html">He oblidat la Contrasenya?</a>
                    <br><br>
                    <a href="./index.php">Torna al inici</a>
                  </div>
                </div>
                <!-- Afegir nous camps al formulari -->
                <div class="sign-up-form">
                  <div class="group">
                    <label for="name" class="label">Nom</label>
                    <input id="name" type="text" class="input" placeholder="Introdueix el teu Nom">
                  </div>
                  <div class="group">
                    <label for="surname" class="label">Cognom</label>
                    <input id="surname" type="text" class="input" placeholder="Introdueix el teu Cognom">
                  </div>
                  <div class="group">
                    <label for="email" class="label">Email</label>
                    <input id="email" type="text" class="input" placeholder="Introdueix el teu Email">
                  </div>
                  <div class="group">
                    <label for="usernameRegister" class="label">Nom d'Usuari</label>
                    <input id="usernameRegister" type="text" class="input" placeholder="Introdueix el teu Nom d'Usuari"
                      autocomplete="username">
                  </div>
                  <div class="group">
                    <label for="password_signup" class="label">Contrasenya</label>
                    <input id="password_signup" type="password" class="input"
                      placeholder="Introdueix la teva Contrasenya" autocomplete="new-password">
                  </div>
                  <div class="group">
                    <label for="password_repeat" class="label">Repeteix Contrasenya</label>
                    <input id="password_repeat" type="password" class="input" placeholder="Repeteix la teva Contrasenya"
                      autocomplete="new-password">
                  </div>
                  <div class="group">
                    <input type="submit" class="button" value="Registrar-se" onclick="register()">
                  </div>
                  <div class="foot">
                    <a href="./index.php">Torna al inici</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      function login() {
        // Obtener los datos del formulario
        var username = $("#username").val();
        var password = $("#password").val();

        // Realizar una llamada AJAX al backend (ruta relativa al mismo directorio)
        $.ajax({
          type: "POST",
          url: "../assets/php/auth.php",
          data: {
            username: username,
            password: password
          },
          success: function (data) {
            var usuariCarregat = data;
            if (usuariCarregat.status === "OK") {
              // Si la autenticación es exitosa, redireccionar a Funciona.html
              window.location.href = "./index.php";
            } else {
              // Si la autenticación no es exitosa, mostrar un alert
              alert("Credenciales incorrectas. Inténtalo de nuevo.");
            }
          },
          error: function (xhr, status, error) {
            // En caso de error con la llamada AJAX, mostrar información del error
            console.error(xhr.responseText);
            alert("Ha habido un error al procesar la solicitud. Inténtalo de nuevo más tarde.");
          }
        });
      }

      function register() {
        // Obtener los datos del formulario
        var name = $("#name").val();
        var surname = $("#surname").val();
        var email = $("#email").val();
        var usernameRegister = $("#usernameRegister").val();
        var password_signup = $("#password_signup").val();
        var password_repeat = $("#password_repeat").val();

        // Verificar que las contraseñas coinciden
        if (password_signup !== password_repeat) {
          alert("Las contraseñas no coinciden. Inténtalo de nuevo.");
          return;
        }

        // Realizar una llamada AJAX al backend (cambia la URL con tu API de registro)
        $.ajax({
          type: "POST",
          url: "../assets/php/registrar.php",
          data: {
            name: name,
            surname: surname,
            email: email,
            username: usernameRegister,
            password: password_signup
          },
          success: function (response) {
            if (response === "OK") {
              alert("Registro exitoso. Ahora puedes iniciar sesión.");
              // También podrías redireccionar al usuario a la página de inicio de sesión.
            } else {
              alert("Ha habido un problema con el registro. Inténtalo de nuevo.");
            }
          },
          error: function () {
            alert("Ha habido un error al procesar la solicitud. Inténtalo de nuevo más tarde.");
          }
        });
      }
    </script>


  </body>

</html>
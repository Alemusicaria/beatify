<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6102a80a3f.js" crossorigin="anonymous"></script>
    <link rel="icon" href="./img/Logo_sense_fons.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./estil.css">
    <!--<script src="./perfil.js" defer></script> -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <title>Beatify</title>
</head>

<body>
    <header>
        <div class="menu">
            <a href="./premium/premium.html">Premium</a>
            <a href="">Asistencia</a>

            <button id="iniciarSessio">Iniciar Sessió</button>
        </div>
    </header>
    <div class="contenedor-left">
        <div class="miniMenu">
            <ul id="menu">
                <li><a href="./index.html"><img src="./img/Logo_sense_fons.png" alt="">BEATIFY</a></li>
                <li><a href="./index.html"><i class="fa-solid fa-house" style="color: rgb(255, 255, 255);"></i>INICI</a>
                </li>
                <li><i class="fa-solid fa-magnifying-glass" style="color: rgb(255, 255, 255);"></i><input type="text"
                        id="searchInput" placeholder="Buscar canciones"></li>
            </ul>
        </div>
        <br>
        <div class="llistesUsuaris">
            <h2><i class="fa-solid fa-compact-disc"></i>Llistes Cançons</h2>
            <div id="primera">
                <h4>Crea la teva Primera Llista</h4>
                <p>Es molt fàcil</p>
                <button>Crea Llista</button>
            </div>
            <br>
            <div class="fakeFooter">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque gravida nec est non elementum.
                    In sollicitudin augue nunc, sed bibendum est pretium a. Sed quam sapien, luctus sit amet libero sed
                </p>
            </div>
        </div>
    </div>
    <div class="contenedor-right">
        <h2>Totes les cançons</h2>
        <div id="taula">
        </div>
        <p>&copy; 2024 Beatify. Tots els drets reservats.</p>
    </div>

    <footer>
        <div class="reproductor-musica">
            <div class="reproductor-contenido">
                <div class="reproductor-info">
                    <img src="" alt="portada" id="reproductor-img">
                    <div class="info-text">
                        <h4 id="reproductor-title"></h4>
                        <p id="reproductor-artist"></p>
                    </div>
                </div>
                <div class="music-player-container">
                    <div class="controls-music-container">
                        <div class="progress-song-container">
                            <div class="progress-bar">
                                <span class="progress"></span>
                            </div>
                        </div>
                        <div class="time-container">
                            <span class="time-left" id="CurrentSongTime"></span>
                            <span class="time-left" id="SongLength"></span>
                        </div>
                    </div>
                    <audio controls preload="metadata" src="" id="reproductor-audio"></audio>
                    <div class="main-song-controls">
                        <img src="./img/simbols/Backward.svg" alt="" class="icon" id="Back10">
                        <img src="./img/simbols/Play.svg" alt="" class="icon" id="PlayPause">
                        <img src="./img/simbols/Forward.svg" alt="" class="icon" id="Plus10">
                    </div>
                </div>
                <div class="volume-container">
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0">
                    <img id="volumeIcon" src="./img/simbols/volume.svg" alt="Volume">
                </div>
            </div>
        </div>
    </footer>

    <script>
        const audio1 = document.querySelector('audio');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeIcon = document.getElementById('volumeIcon');

        // Set initial volume value and icon
        audio1.volume = volumeSlider.value;

        volumeSlider.addEventListener('input', () => {
            audio1.volume = volumeSlider.value;
            updateVolumeIcon();
        });

        function updateVolumeIcon() {
            // Change volume icon based on the volume level
            if (audio1.volume === 0) {
                volumeIcon.src = './img/simbols/mute.svg';
            } else if (audio1.volume < 0.5) {
                volumeIcon.src = './img/simbols/volume-low.svg';
            } else if (audio1.volume > 0.5 < 0.9) {
                volumeIcon.src = './img/simbols/volume-high.svg';
            } else {
                volumeIcon.src = './img/simbols/volume.svg';
            }
        }
        // Call updateVolumeIcon initially to set the correct volume icon
        updateVolumeIcon();


        var canconsCarregades = []; // Array per emmagatzemar les cançons ja carregades

        function carregarCancons() {
            $.ajax({
                url: 'conexio.php',
                method: 'GET',
                success: function (data) {
                    canconsCarregades = JSON.parse(data); // Emmagatzemar les cançons a nivell local
                    mostrarCancons(canconsCarregades); // Mostrar totes les cançons inicials
                },
                error: function (error) {
                    console.log('Error en carregar les cançons:', error);
                }
            });
        }

        function mostrarCancons(cancons) {
            var taula = $('#taula');
            taula.empty(); // Netegem la taula abans de mostrar les cançons

            $.each(cancons, function (index, canco) {
                var novaCancoDiv = $('<div class="songs"></div>');
                novaCancoDiv.append('<img src="./musica/portades/' + canco.Img + '" alt="' + canco.Titol + '" class="portada">');
                novaCancoDiv.append('<img src="./img/playImg.png" alt="icon" class="icono">');
                novaCancoDiv.append('<h4>' + canco.Titol + '</h4>');

                taula.append(novaCancoDiv);
            });

            // Agregar evento de clic a les imatges amb la classe 'icono'
            $('.icono').on('click', transferirInformacion);
        }

        // Función para transferir información al reproductor de música
        function transferirInformacion(event) {
            var cancoDiv = $(this).closest('.songs');
            var imgSrc = cancoDiv.find('img.portada').attr('src');
            var songTitle = cancoDiv.find('h4').text();
            var artistInfo = cancoDiv.find('p').text();

            var reproductorImg = $('#reproductor-img');
            var reproductorTitle = $('#reproductor-title');
            var reproductorArtist = $('#reproductor-artist');
            var reproductorAudio = $('#reproductor-audio');

            reproductorImg.attr('src', imgSrc);
            reproductorTitle.text(songTitle);
            reproductorArtist.text(artistInfo);
            reproductorAudio.attr('src', "./musica/mp3/" + songTitle + ".mp3");
            reproductorAudio[0].play(); // Iniciar la reproducción
        }

        $(document).ready(function () {
            carregarCancons();
        });

        $('#iniciarSessio').on('click', function () {
            window.location.href = './login/login.html';
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Obtén la llista de cançons i el camp de cerca
            const searchInput = document.getElementById('searchInput');

            // Agrega un event de escolta al camp de cerca
            searchInput.addEventListener('input', function () {
                const searchTerm = searchInput.value.toLowerCase();

                // Filtra les cançons ja carregades
                const canconsFiltrades = canconsCarregades.filter(function (canco) {
                    return canco.Titol.toLowerCase().includes(searchTerm);
                });

                // Mostra les cançons filtrades
                mostrarCancons(canconsFiltrades);
            });
        });
    </script>
    <script src="code.js"></script>
</body>

</html>
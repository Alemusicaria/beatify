<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6102a80a3f.js" crossorigin="anonymous"></script>
    <link rel="icon" href="./img/Logo_sense_fons.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./estil.css">
    <!--<script src="./perfil.js" defer></script> -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <title>Beatify</title>
</head>

<body>
    <header>
        <div class="menu">
            <a href="./premium/premium.html">Premium</a>
            <a href="">Asistencia</a>

            <button id="iniciarSessio">Iniciar Sessió</button>
        </div>
    </header>
    <div class="contenedor-left">
        <div class="miniMenu">
            <ul id="menu">
                <li><a href="./index.html"><img src="./img/Logo_sense_fons.png" alt="">BEATIFY</a></li>
                <li><a href="./index.html"><i class="fa-solid fa-house" style="color: rgb(255, 255, 255);"></i>INICI</a>
                </li>
                <li><i class="fa-solid fa-magnifying-glass" style="color: rgb(255, 255, 255);"></i><input type="text"
                        id="searchInput" placeholder="Buscar canciones"></li>
            </ul>
        </div>
        <br>
        <div class="llistesUsuaris">
            <h2><i class="fa-solid fa-compact-disc"></i>Llistes Cançons</h2>
            <div id="primera">
                <h4>Crea la teva Primera Llista</h4>
                <p>Es molt fàcil</p>
                <button>Crea Llista</button>
            </div>
            <br>
            <div class="fakeFooter">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque gravida nec est non elementum.
                    In sollicitudin augue nunc, sed bibendum est pretium a. Sed quam sapien, luctus sit amet libero sed
                </p>
            </div>
        </div>
    </div>
    <div class="contenedor-right">
        <h2>Totes les cançons</h2>
        <div id="taula">
        </div>
        <p>&copy; 2024 Beatify. Tots els drets reservats.</p>
    </div>

    <footer>
        <div class="reproductor-musica">
            <div class="reproductor-contenido">
                <div class="reproductor-info">
                    <img src="" alt="portada" id="reproductor-img">
                    <div class="info-text">
                        <h4 id="reproductor-title"></h4>
                        <p id="reproductor-artist"></p>
                    </div>
                </div>
                <div class="music-player-container">
                    <div class="controls-music-container">
                        <div class="progress-song-container">
                            <div class="progress-bar">
                                <span class="progress"></span>
                            </div>
                        </div>
                        <div class="time-container">
                            <span class="time-left" id="CurrentSongTime"></span>
                            <span class="time-left" id="SongLength"></span>
                        </div>
                    </div>
                    <audio controls preload="metadata" src="" id="reproductor-audio"></audio>
                    <div class="main-song-controls">
                        <img src="./img/simbols/Backward.svg" alt="" class="icon" id="Back10">
                        <img src="./img/simbols/Play.svg" alt="" class="icon" id="PlayPause">
                        <img src="./img/simbols/Forward.svg" alt="" class="icon" id="Plus10">
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <script>
        function carregarCancons() {
            $.ajax({
                url: 'conexio.php',
                method: 'GET',
                success: function (data) {
                    var cancons = JSON.parse(data);
                    var taula = $('#taula');

                    $.each(cancons, function (index, canco) {
                        var novaCancoDiv = $('<div class="songs"></div>');
                        novaCancoDiv.append('<img src="./musica/portades/' + canco.Img + '" alt="' + canco.Titol + '" class="portada">');
                        novaCancoDiv.append('<img src="./img/playImg.png" alt="icon" class="icono">');
                        novaCancoDiv.append('<h4>' + canco.Titol + '</h4>');

                        taula.append(novaCancoDiv);
                    });

                    // Agregar evento de clic a las imágenes con la clase 'icono'
                    $('.icono').on('click', transferirInformacion);
                },
                error: function (error) {
                    console.log('Error en cargar las canciones:', error);
                }
            });
        }

        // Función para transferir información al reproductor de música
        function transferirInformacion(event) {
            var cancoDiv = $(this).closest('.songs');
            var imgSrc = cancoDiv.find('img.portada').attr('src');
            var songTitle = cancoDiv.find('h4').text();
            var artistInfo = cancoDiv.find('p').text();

            var reproductorImg = $('#reproductor-img');
            var reproductorTitle = $('#reproductor-title');
            var reproductorArtist = $('#reproductor-artist');
            var reproductorAudio = $('#reproductor-audio');

            reproductorImg.attr('src', imgSrc);
            reproductorTitle.text(songTitle);
            reproductorArtist.text(artistInfo);
            reproductorAudio.attr('src', "./musica/mp3/" + songTitle + ".mp3");
            reproductorAudio[0].play(); // Iniciar la reproducción
        }

        $(document).ready(function () {
            carregarCancons();
        });

        $('#iniciarSessio').on('click', function () {
            window.location.href = './login/login.html';
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Obtén la lista de canciones y el campo de búsqueda
            const songList = document.getElementById('taula');
            const searchInput = document.getElementById('searchInput');

            // Agrega un evento de escucha al campo de búsqueda
            searchInput.addEventListener('input', function () {
                const searchTerm = searchInput.value.toLowerCase();

                // Filtra las canciones basadas en el término de búsqueda
                Array.from(songList.children).forEach(function (song) {
                    const songName = song.textContent.toLowerCase();

                    if (songName.includes(searchTerm)) {
                        song.style.display = 'block'; // Muestra la canción si coincide
                    } else {
                        song.style.display = 'none'; // Oculta la canción si no coincide
                    }
                });
            });
        });
    </script>
    <script src="code.js"></script>
</body>

</html>